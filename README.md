# DAW MCP

> This project is experimental. Only MainStage transport control via AppleScript has been tested.
> Other DAW integrations and most tools return hardcoded demo data.
>
> OCaml + AppleScript + AU plugin code was generated by AI agents (Claude, Gemini, Codex).

MCP server for controlling DAWs (Digital Audio Workstations) from AI clients.

Version: 0.3.0

## Goal

AI-assisted sound design feedback loop:

```
You: "Play a chord"
  ↓
AppleScript/OSC → DAW → Sound plays  (partially working)
  ↓
Audio capture → AI analysis  (TODO)
  ↓
AI: "Try boosting the low end"
```

## Architecture

```
┌─────────────────┐  AppleScript  ┌───────────────┐
│  OCaml MCP      │──────────────▶│  MainStage    │  Tested
│  Server         │               │  Logic Pro    │  Untested
│                 │     OSC       ├───────────────┤
│                 │──────────────▶│  Reaper       │  Untested
│                 │               │  Ableton Live │  Untested
└─────────────────┘               └───────────────┘

         (future)
              │
              ▼
┌──────────────────┐     Audio    ┌─────────┐
│  DAW Bridge AU   │◀────────────│  DAW    │  Not yet
│  (Audio Unit)    │             │         │
└──────────────────┘             └─────────┘
        │
        ▼
  Audio Analysis → AI Feedback
```

- **OCaml MCP Server**: MCP protocol (JSON-RPC + SSE), DAW driver dispatch
- **DAW Bridge AU**: Audio Unit plugin for audio capture (code exists, untested)
- **xcode/**: AU plugin source (ObjC)

## DAW Support

4 DAWs have driver code. Only MainStage has been tested.

| DAW | Status | Protocol | Driver File |
|-----|--------|----------|-------------|
| MainStage | Tested (transport only) | AppleScript + System Events | `lib/daw/mainstage.ml` |
| Reaper | Code exists, untested | OSC (port 8000) | `lib/daw/reaper.ml` |
| Logic Pro | Code exists, untested | AppleScript | `lib/daw/logic.ml` |
| Ableton Live | Code exists, untested | OSC | `lib/daw/ableton.ml` |
| Cubase | ID defined, no driver | - | - |
| Pro Tools | ID defined, no driver | - | - |
| FL Studio | ID defined, no driver | - | - |

## Features

| Feature | Status |
|---------|--------|
| DAW detection and connection | Tested (MainStage) |
| Transport control (play/stop/record) | Tested (MainStage) |
| Tempo get/set | Code exists, routes through integration layer |
| Track selection, mixer, track listing | Code exists, routes through integration layer |
| Automation (read/write/mode) | Stub - returns demo data |
| Plugin parameter control | Stub - returns hardcoded values |
| Markers and regions | Stub - returns hardcoded demo data |
| Routing and sends | Stub - returns hardcoded demo data |
| Render/bounce | Stub |
| Audio level metering | Simulated data (sine wave) |
| Real-time meter SSE stream | Stub (returns stream ID, no real data) |
| Audio settings | Stub - returns hardcoded defaults |
| Audio stream analysis | TODO |
| Natural language sound design | TODO |

## MCP Tools (17 total)

### Integration layer (routed to DAW driver)

These tools dispatch commands through the driver interface to the connected DAW.

| Tool | Description | Status |
|------|-------------|--------|
| `daw_detect` | Detect running DAWs, connect | Implemented |
| `daw_transport` | play, stop, record | Implemented |
| `daw_tempo` | Get/set BPM | Implemented |
| `daw_select_track` | Select track by index | Implemented |
| `daw_mixer` | Volume, pan, mute, solo | Implemented |
| `daw_tracks` | List all tracks | Implemented |
| `daw_status` | Connection status | Implemented |

### Stub/demo (hardcoded responses, not connected to DAW)

These tools accept parameters and return data, but do not communicate with any DAW.

| Tool | Description | Status |
|------|-------------|--------|
| `daw_automation_read` | Read automation data | Stub (returns demo points) |
| `daw_automation_write` | Write automation points | Stub |
| `daw_automation_mode` | Set automation mode | Stub (validates mode string only) |
| `daw_plugin_param` | Get/set plugin parameters | Stub (returns fixed value 0.5) |
| `daw_markers` | Manage markers/regions | Stub (returns hardcoded markers) |
| `daw_routing` | Track routing and sends | Stub (returns hardcoded routing) |
| `daw_render` | Bounce/render project | Stub |
| `daw_meter` | Audio level metering | Simulated (generates sine wave data) |
| `daw_meter_stream` | Real-time meter SSE stream | Stub (returns stream ID only) |
| `daw_settings` | Audio settings (sample rate, buffer) | Stub (returns hardcoded 44100/512) |

## MCP Resources

- `daw://docs/usage` - Usage and run modes
- `daw://docs/tools` - Tool inventory

### Example Use Cases (untested except transport)

```
"템포 120으로"        → daw_tempo(bpm: 120)
"녹음 시작"           → daw_transport(action: "record")
"보컬 트랙 -3dB"      → daw_mixer(track: 1, volume: -3)
"기타 왼쪽으로 팬"    → daw_mixer(track: 2, pan: -50)
"여기 마커 찍어"      → daw_markers(action: "add", name: "Hook")
"이 구간 10번 반복"   → daw_markers + daw_transport (loop)
```

## Requirements

| 항목 | 버전 | 비고 |
|------|------|------|
| OCaml | >= 5.2 | `dune-project` 기준 |
| dune | >= 3.16 | `dune-project` 기준 |
| macOS | 12+ | CoreAudio/CoreMIDI framework 필요 |
| Xcode | 15+ | AU plugin 빌드 시에만 필요 |

Linux/Windows는 지원하지 않습니다. AppleScript와 CoreAudio에 의존합니다.

## Quick Start

```bash
# Build MCP server
opam install . --deps-only
dune build

# Build AU plugin (optional)
cd xcode && xcodebuild

# Run (HTTP mode)
./start-daw-mcp.sh --http --port 8950

# Run (stdio mode for MCP)
./start-daw-mcp.sh
```

## TODO

- [ ] Audio stream analysis via AU plugin
- [ ] Natural language sound design
- [ ] Real metering (replace simulated data with AU plugin bridge)
- [ ] Test Reaper, Logic Pro, Ableton drivers
- [ ] Connect stub tools to integration layer
- [ ] Documentation

## License

MIT
